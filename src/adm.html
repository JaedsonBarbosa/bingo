<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/png" href="assets/logo.jpg" />
    <title>Administração</title>

    <link rel="stylesheet" href="style/global.scss" />
    <script type="module" src="code/adm.ts"></script>
  </head>
  <body x-data="admin">
    <include src="modules/header.html"></include>
    <main class="container" x-cloak>
      <div x-show="tela == 'inicio'">
        <h3>Jogos</h3>
        <a
          class="button"
          x-show="jogo?.organizador.telefone == telefone"
          href="#jogo"
        >
          Gerenciar
        </a>
        <a class="button" x-show="! jogo" href="#addJogo">Abrir</a>
        <a class="button" x-show="jogos.length" href="#jogos">Consultar</a>
        <hr />
        <h3>Administradores</h3>
        <a class="button" href="#addAdmin">Adicionar</a>
        <a class="button" href="#admins">Consultar</a>
        <hr />
        <h3>Usuários</h3>
        <a class="button" href="#usuarios">Consultar</a>
      </div>
      <template x-if="tela == 'addJogo'">
        <form x-data="{ titulo: '' }" @submit.prevent="novoJogo(titulo)">
          <label>
            Título
            <input x-model="titulo" minlength="4" required />
          </label>
          <button type="button" @click="abrir('inicio')">Cancelar</button>
          <input type="submit" />
        </form>
      </template>
      <div x-show="tela == 'jogo'">
        <h3>Gerenciamento de jogos</h3>
        <button @click="abrir('inicio')">Voltar</button>
        <button @click="encerrarJogo">Cancelar jogo</button>
        <button @click="chamarNumero">Chamar número</button>
        <p>
          Números chamados:
          <em
            x-data="{ get numeros() { return jogo?.numeros.join(', ') } }"
            x-text="numeros ? numeros : 'Aguardando...'"
          ></em>
        </p>
        <p aria-live="assertive">
          Último número:
          <em x-text="jogo?.numeros[0] ?? 'Aguardando...'"></em>
        </p>
        <p>
          Quantidade de números chamados:
          <em x-text="jogo?.numeros.length ?? 0"></em>
        </p>
      </div>
      <include src="modules/jogos.html"></include>
      <template x-if="tela == 'addAdmin'">
        <div
          x-data="{ tel: '', get comuns() { return usuarios.filter(v => !v.admin) } }"
        >
          <h3>Adicionar administrador</h3>
          <button @click="abrir('inicio')">Voltar</button>
          <label>
            Telefone
            <input x-model="tel" list="usuarios" />
          </label>
          <datalist id="usuarios">
            <template x-for="a in comuns">
              <option x-text="a.telefone"></option>
            </template>
          </datalist>
          <template
            x-data="{ get u() { return comuns.find(v => v.telefone == tel) } }"
            x-if="u"
          >
            <div>
              <p>
                Telefone:
                <span x-text="u?.telefone"></span>
                <br />
                Nome:
                <span x-text="u?.nome"></span>
                <br />
                Estado:
                <span x-text="u?.estado"></span>
                <br />
                Município
                <span x-text="u?.municipio"></span>
              </p>
              <button @click="u?.inverterAdmin">Promover</button>
            </div>
          </template>
        </div>
      </template>
      <div
        x-data="{ get admins() { return tela == 'admins' } }"
        x-show="admins || tela == 'usuarios'"
      >
        <h3 x-show="admins">Administradores</h3>
        <h3 x-show="! admins">Usuários</h3>
        <button @click="abrir('inicio')">Voltar</button>
        <template
          x-data="{ get filtrados() { return usuarios.filter(v => v.admin == admins) } }"
          x-for="u in filtrados"
        >
          <details>
            <summary x-text="u.nome"></summary>
            <p>
              Telefone:
              <span x-text="u.telefone"></span>
              <br />
              Estado:
              <span x-text="u.estado"></span>
              <br />
              Município
              <span x-text="u.municipio"></span>
            </p>
            <button @click="u.inverterAdmin">Remover</button>
          </details>
        </template>
      </div>
    </main>
  </body>
</html>
